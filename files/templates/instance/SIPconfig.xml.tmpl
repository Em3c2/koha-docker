<acsconfig xmlns="http://openncip.org/acs-config/1.0/">
<!-- above address gets nothing, it's just a namespace -->
  <error-detect enabled="true" />

<!--
  Set Net::Server::PreFork runtime parameters
  syslog_ident will identify SIP2 Koha server entries in syslog
  For OpenSolaris, add: syslog_logsock=stream
-->
  <server-params
    min_servers="$SIP_WORKERS"
    min_spare_servers='2'
    log_file='Sys::Syslog'
    syslog_ident='koha_sip'
    syslog_facility='local6'
    ipv='4'
  />

  <listeners>
<!-- vestigial HTTP, never implemented: just use the OPAC!
  <service
      port="0:8080/tcp"
      transport="http"
      protocol="NCIP/1.0" />
-->
    <service
      port="8023/tcp"
      transport="telnet"
      protocol="SIP/2.00"
      timeout="1800" />

<!-- external listener -->
    <service
      port="$SIP_PORT/tcp"
      transport="RAW"
      protocol="SIP/2.00"
      timeout="1800"
      client_timeout="1800" />
      <!--
        client_timeout: seconds to wait before disconnecting idle clients
        timeout:        seconds to wait before disconnecting failed logons
        -->
  </listeners>

  <accounts>
    <!-- example login
    <login encoding="utf8" id="$SIP_AUTOUSER1" password="$SIP_AUTOPASS1" delimiter="|" error-detect="enabled" institution="HUTL"
      checked_in_ok="1"                   : dont fail checkin on non checked out items
      send_patron_home_library_in_af="1"  : add home library to patron status
      av_field_template="[% accountline.description %] [% accountline.amountoutstanding | format('%.2f') %]"    : Fine items template
      validate_patron_attribute="MEROPPET"    : a patron attribute to validate patron against in patron information request.
                                                Anything but 1 in this fields means no access/not able to loan.
      >
        <screen_msg_regex find="Greetings from Koha." replace="Welcome to your library!" />
    </login>
    -->
    <!-- DOOR ACCESS ACOUNTS START -->
    <login encoding="utf8" id="$SIP_DOORUSER1" password="$SIP_DOORPASS1" delimiter="|" error-detect="enabled" institution="hutl" validate_patron_attribute="dooraccess" />
    <!-- DOOR ACCESS ACOUNTS END -->

    <!-- AUTOMAT ACOUNTS START -->
    <login encoding="utf8" id="$SIP_AUTOUSER1" password="$SIP_AUTOPASS1" delimiter="|" error-detect="enabled" institution="hutl" checked_in_ok="1">
       <!-- General messages -->
        <screen_msg_regex find="^.*Invalid password.*$" replace="Feil passord" />

        <!-- Checkout screen messages we can translate directly -->
        <screen_msg_regex find="Item checked out to another patron.*$" replace="Materialet er lånt ut til en annen låner." />
        <screen_msg_regex find="Item already checked out to you: renewing item." replace="Denne fornyes siden du allerede har lånt den." />
        <screen_msg_regex find="Item was reserved for you." replace="Du hadde reservert denne." />
        <screen_msg_regex find="Item is reserved for another patron upon return." replace="Materialet er reservert av en annen låner." />
        <screen_msg_regex find="Item already checked out to another patron.  Please return item for check-in." replace="Materialet er allerede lånt ut til en annen låner. Vennligst returner det." />
        <screen_msg_regex find="Outstanding Fines block issue.*" replace="Du kan ikke låne grunnet utestående gebyrer." />
        <screen_msg_regex find="Loan period reduced for high-demand item" replace="Låneperioden er redusert pga stor etterspørsel" />
        <screen_msg_regex find="Item is on hold shelf for another patron" replace="Materialet står til avhenting av en annen låner" />
        <screen_msg_regex find="Invalid Item" replace="Ugyldig eksemplar" />
        <screen_msg_regex find="Invalid Patron" replace="Ugyldig lånekort" />
        <screen_msg_regex find="Invalid cardnumber" replace="Ugyldig lånekort" />
        <screen_msg_regex find="^.*Borrower.s card reported lost.*$" replace="Lånekortet er meldt tapt. Vennligst kontakt personalet." />
        <screen_msg_regex find="^.*Borrower has no valid address.*$" replace="Feil i adresse. Vennligst kontakt personalet." />

        <!-- Renew -->
        <screen_msg_regex find="Item unavailable due to outstanding holds" replace="Materialet er utilgjengelig pga ventende reservasjoner" />
        <screen_msg_regex find="Item has reached maximum renewals" replace="Materialet kan ikke lånes flere ganger" />

        <!-- Missing screen messages in Koha and other quirks -->
        <screen_msg_regex find="^.*Patron owes.+$" replace="Du har utestående gebyrer - henvend deg til personalet." />
        <screen_msg_regex find="^Patron Blocked$" replace="Lånekortet er sperret - henvend deg til personalet." />

        <screen_msg_regex find="TOO_MANY_CHECKOUTS" replace="For mange utlån" />
        <screen_msg_regex find="NOT_FOR_LOAN.*$" replace="Materialet er ikke til utlån." />
        <screen_msg_regex find="item_notforloan.*$" replace="Materialet er ikke til utlån." />

        <!-- Bug 15438 - Checking out an on-hold item sends holder's borrowernumber in AF (screen message) field. -->
        <!-- gjelder også utlån av samme eksemplar to ganger -->
        <screen_msg_regex find="^\d{1,}$" replace="Materialet er allerede utlånt/reservert." />

        <!-- Last resort -->
        <screen_msg_regex find="Greetings from Koha." replace="Melding fra biblioteket:" />
    </login>
    <!-- AUTOMAT ACOUNTS END -->
  </accounts>

<!--
Institution tags are for enabled branches.  There needs to be one
institution stanza for each institution named in the accounts above.
The implementation attribute is actually used to find the code to run,
in our case "ILS".
-->

<institutions>
    <institution id="hutl" implementation="ILS" parms="">
          <policy checkin="true" renewal="true" checkout="true"
      status_update="false" offline="false"
      timeout="1800"
      retries="5" />
    </institution>
</institutions>
</acsconfig>
